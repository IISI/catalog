if(!window.OpenAjax){OpenAjax=new function(){var b=true;var i=false;var d=window;var a="org.openajax.hub.";var c={};this.hub=c;c.implementer="http://openajax.org";c.implVersion="2.0";c.specVersion="2.0";c.implExtraData={};var e={};c.libraries=e;c.registerLibrary=function(j,h,g,f){e[j]={prefix:j,namespaceURI:h,version:g,extraData:f};this.publish(a+"registerLibrary",e[j])};c.unregisterLibrary=function(f){this.publish(a+"unregisterLibrary",e[f]);delete e[f]};c._subscriptions={c:{},s:[]};c._cleanup=[];c._subIndex=0;c._pubDepth=0;c.subscribe=function(f,n,k,j,h){if(!k){k=window}var l=f+"."+this._subIndex;var g={scope:k,cb:n,fcb:h,data:j,sid:this._subIndex++,hdl:l};var m=f.split(".");this._subscribe(this._subscriptions,m,0,g);return l};c.publish=function(f,h){var j=f.split(".");this._pubDepth++;this._publish(this._subscriptions,j,0,f,h);this._pubDepth--;if((this._cleanup.length>0)&&(this._pubDepth==0)){for(var g=0;g<this._cleanup.length;g++){this.unsubscribe(this._cleanup[g].hdl)}delete (this._cleanup);this._cleanup=[]}};c.unsubscribe=function(g){var h=g.split(".");var f=h.pop();this._unsubscribe(this._subscriptions,h,0,f)};c._subscribe=function(f,k,g,j){var h=k[g];if(g==k.length){f.s.push(j)}else{if(typeof f.c=="undefined"){f.c={}}if(typeof f.c[h]=="undefined"){f.c[h]={c:{},s:[]};this._subscribe(f.c[h],k,g+1,j)}else{this._subscribe(f.c[h],k,g+1,j)}}};c._publish=function(t,s,n,f,g,m){if(typeof t!="undefined"){var h;if(n==s.length){h=t}else{this._publish(t.c[s[n]],s,n+1,f,g,m);this._publish(t.c["*"],s,n+1,f,g,m);h=t.c["**"]}if(typeof h!="undefined"){var o=h.s;var r=o.length;for(var k=0;k<r;k++){if(o[k].cb){var q=o[k].scope;var j=o[k].cb;var l=o[k].fcb;var p=o[k].data;if(typeof j=="string"){j=q[j]}if(typeof l=="string"){l=q[l]}if((!l)||(l.call(q,f,g,p))){j.call(q,f,g,p,m)}}}}}};c._unsubscribe=function(o,n,j,g){if(typeof o!="undefined"){if(j<n.length){var f=o.c[n[j]];this._unsubscribe(f,n,j+1,g);if(f.s.length==0){for(var m in f.c){return}delete o.c[n[j]]}return}else{var k=o.s;var l=k.length;for(var h=0;h<l;h++){if(g==k[h].sid){if(this._pubDepth>0){k[h].cb=null;this._cleanup.push(k[h])}else{k.splice(h,1)}return}}}}}};OpenAjax.hub.registerLibrary("OpenAjax","http://openajax.org/hub","1.0",{})}if(!window.PageBus){PageBus=new function(){var D=0;var Q=[];var that=this;this.version="2.0.0";this._debug=function(){debugger};_badParm=function(){throw new Error("OpenAjax.hub.Errors.BadParameters")};_valPub=function(name){if((name==null)||(name.indexOf("*")!=-1)||(name.indexOf("..")!=-1)||(name.charAt(0)==".")||(name.charAt(name.length-1)==".")){_badParm()}};_valSub=function(name){var path=name.split(".");var len=path.length;for(var i=0;i<len;i++){if((path[i]=="")||((path[i].indexOf("*")!=-1)&&(path[i]!="*")&&(path[i]!="**"))){_badParm()}if((path[i]=="**")&&(i<len-1)){_badParm()}}return path};_cacheIt=function(subData){return((subData)&&(typeof subData=="object")&&(subData.PageBus)&&(subData.PageBus.cache))};_TopicMatcher=function(){this._items={}};_TopicMatcher.prototype.store=function(topic,val){var path=topic.split(".");var len=path.length;_recurse=function(tree,index){if(index==len){tree["."]={topic:topic,value:val}}else{var token=path[index];if(!tree[token]){tree[token]={}}_recurse(tree[token],index+1)}};_recurse(this._items,0)};_TopicMatcher.prototype.match=function(topic,exactMatch){var path=topic.split(".");var len=path.length;var res=[];_recurse=function(tree,index){if(!tree){return}var node;if(index==len){node=tree}else{_recurse(tree[path[index]],index+1);if(exactMatch){return}if(path[index]!="**"){_recurse(tree["*"],index+1)}node=tree["**"]}if((!node)||(!node["."])){return}res.push(node["."])};_recurse(this._items,0);return res};_TopicMatcher.prototype.exists=function(topic,exactMatch){var path=topic.split(".");var len=path.length;var res=false;_recurse=function(tree,index){if(!tree){return}var node;if(index==len){node=tree}else{_recurse(tree[path[index]],index+1);if(res||exactMatch){return}if(path[index]!="**"){_recurse(tree["*"],index+1);if(res){return}}node=tree["**"]}if((!node)||(!node["."])){return}res=true};_recurse(this._items,0);return res};_TopicMatcher.prototype.clear=function(topic){var path=topic.split(".");var len=path.length;_recurse=function(tree,index){if(!tree){return}if(index==len){if(tree["."]){delete tree["."]}}else{_recurse(tree[path[index]],index+1);for(var x in tree[path[index]]){return}delete tree[path[index]]}};_recurse(this._items,0)};_TopicMatcher.prototype.wildcardMatch=function(topic){var path=topic.split(".");var len=path.length;var res=[];_recurse=function(tree,index){var tok=path[index];var node;if((!tree)||(index==len)){return}if(tok=="**"){for(var n in tree){if(n!="."){node=tree[n];if(node["."]){res.push(node["."])}_recurse(node,index)}}}else{if(tok=="*"){for(var n in tree){if((n!=".")&&(n!="**")){node=tree[n];if(index==len-1){if(node["."]){res.push(node["."])}}else{_recurse(node,index+1)}}}}else{node=tree[tok];if(!node){return}if(index==len-1){if(node["."]){res.push(node["."])}}else{_recurse(node,index+1)}}}};_recurse(this._items,0);return res};this._refs={};this._doCache=new _TopicMatcher();this._caches=new _TopicMatcher();_isCaching=function(topic){return that._doCache.exists(topic,false)};_copy=function(obj){var c;if(typeof(obj)=="object"){if(obj==null){return null}else{if(obj.constructor==Array){c=[];for(var i=0;i<obj.length;i++){c[i]=_copy(obj[i])}return c}else{if(obj.constructor==Date){c=new Date();c.setDate(obj.getDate());return c}}}c={};for(var p in obj){c[p]=_copy(obj[p])}return c}else{return obj}};this._add=function(topic,subID){var dc;var dca=this._doCache.match(topic,true);if(dca.length>0){dc=dca[0].value}else{dc={rc:0};this._doCache.store(topic,dc)}dc.rc++;this._refs[subID]=topic};this._remove=function(subID){var topic=this._refs[subID];if(!topic){return}delete this._refs[subID];var dca=this._doCache.match(topic,true);if(dca.length==0){return}dca[0].value.rc--;if(dca[0].value.rc==0){this._doCache.clear(topic);var caches=this._caches.wildcardMatch(topic);for(var i=0;i<caches.length;i++){if(!(this._doCache.exists(caches[i].topic,false))){this._caches.clear(caches[i].topic)}}}};this.subscribe=function(topic,scope,onData,subscriberData){if(!subscriberData){subscriberData=null}var sid=OpenAjax.hub.subscribe(topic,onData,scope,subscriberData);if(_cacheIt(subscriberData)){this._add(topic,sid);var vals=this.query(topic);for(var i=0;i<vals.length;i++){try{onData.call(scope?scope:window,vals[i].topic,vals[i].value,subscriberData)}catch(e){PageBus._debug()}}}return sid};this.publish=function(topic,data){_valPub(topic);Q.push({n:topic,m:data,d:(D+1)});if(_isCaching(topic)){try{this._caches.store(topic,data)}catch(e){_badParm()}}if(D==0){while(Q.length>0){var qitem=Q.shift();var path=qitem.n.split(".");try{D=qitem.d;OpenAjax.hub.publish(qitem.n,qitem.m);D=0}catch(err){D=0;throw (err)}}}};this.unsubscribe=function(sub){try{this._remove(sub);OpenAjax.hub.unsubscribe(sub)}catch(err){_badParm()}};this.store=function(topic,data){if(!_isCaching(topic)){throw new Error("PageBus.cache.NoCache")}this.publish(topic,data)};this.query=function(topic){try{_valSub(topic);return this._caches.wildcardMatch(topic)}catch(e){_badParm()}}};OpenAjax.hub.registerLibrary("PageBus","http://tibco.com/PageBus","1.2.0",{})};